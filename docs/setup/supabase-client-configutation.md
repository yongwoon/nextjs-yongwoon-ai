# Supabase Client Configuration 구성 요약

이 문서는 프로젝트에서 사용하는 Supabase 클라이언트 설정의 구조와 주요 기능을 요약합니다.

---

## 1. 환경 변수 검증 및 에러 처리
- 필수 환경 변수(`NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`)를 코드 시작 시 검증합니다.
- 누락 시 명확한 에러 메시지를 발생시켜 안전성을 높입니다.
- 관리자 클라이언트용 Service Role Key(`SUPABASE_SERVICE_ROLE_KEY`)도 필요 시 검증합니다.

## 2. 다양한 Supabase 클라이언트 인스턴스
- **클라이언트용**: 브라우저에서 사용, 세션 관리 및 자동 토큰 갱신 지원
- **서버용**: 서버 컴포넌트/액션에서 사용, 액세스 토큰을 받아 인증 헤더에 포함
- **관리자용**: 서버에서만 사용, RLS(행 수준 보안) 우회 가능

## 3. 타입 안전성 강화
- Supabase DB 스키마와 연동된 타입 헬퍼(`Tables`, `TablesInsert`, `TablesUpdate`)
- 자주 사용하는 테이블 타입 별칭 제공 (`Profile`, `Conversation`, `Message` 등)

## 4. 인증 관련 헬퍼 함수
- 현재 사용자 정보/세션 조회
- 매직 링크(OTP) 로그인 및 인증
- 로그아웃 기능

## 5. 실시간 구독 유틸리티
- 대화별 메시지 실시간 구독
- 사용자별 대화 실시간 구독
- PostgreSQL 변경사항을 실시간으로 감지

## 6. 서버 측 유틸리티
- Next.js Request 객체에서 클라이언트 생성
- 쿠키 기반 서버 클라이언트 생성 (App Router 지원)
- 요청별 사용자 인증 상태 확인

## 7. Row Level Security(RLS) 지원
- 리소스(대화, 메시지, 문서)별 소유권 및 접근 권한 검증
- 조인을 활용한 복잡한 권한 로직 구현

## 8. 성능 및 모니터링
- 쿼리 성능 측정 및 개발 환경에서 자동 로깅
- 대량 데이터 삽입 등 배치 작업 지원

## 9. 에러 처리
- PostgreSQL 에러 코드별 사용자 친화적 메시지 제공(한국어)
- 알 수 없는 오류도 일관되게 처리

## 10. 데이터베이스 연결 상태 확인
- 연결 상태를 확인하는 헬스체크 함수 제공

